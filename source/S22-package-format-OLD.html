<!DOCTYPE html>
<html lang="ja">
<head>
<title>S22-package-format-OLD</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" >
<link rel="stylesheet" href="http://yandex.st/highlightjs/8.0/styles/github.min.css">
<link rel="stylesheet" href="default.css">
<script src="http://yandex.st/highlightjs/8.0/highlight.min.js"></script>
<script>hljs.configure( { languages: ['perl'] } ); hljs.initHighlightingOnLoad();</script>
</head>
<body class='pod'>
<!--
  generated by My::Pod v,
  using Pod::Simple::PullParser v3.28,
  under Perl v5.018002 at Sat Aug 30 10:16:52 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to My::Pod, and/or subclassing My::Pod,
   then reconverting this document from the Pod source.
   When in doubt, email the author of My::Pod for advice.
   See 'perldoc My::Pod' for more info.

-->

<!-- start doc -->
<a name='___top' class='dummyTopAnchor' ></a>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#TITLE'>TITLE</a>
  <li class='indexItem indexItem1'><a href='#AUTHORS'>AUTHORS</a>
  <li class='indexItem indexItem1'><a href='#VERSION'>VERSION</a>
  <li class='indexItem indexItem1'><a href='#OVERVIEW'>OVERVIEW</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Terminology_and_Scope'>Terminology and Scope</a>
    <li class='indexItem indexItem2'><a href='#Inspirations'>Inspirations</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#PACKAGE_LAYOUT'>PACKAGE LAYOUT</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Project_directory'>Project directory</a>
    <li class='indexItem indexItem2'><a href='#.jib_files'>.jib files</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#METADATA_SPEC'>METADATA SPEC</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Supported_fields'>Supported fields</a>
    <li class='indexItem indexItem2'><a href='#Suggested_fields%5B3%5D'>Suggested fields[3]</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#DEPENDENCIES'>DEPENDENCIES</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Dependency_Notation'>Dependency Notation</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Basic_notation%3A'>Basic notation:</a>
      <li class='indexItem indexItem3'><a href='#More_complex_examples%3A'>More complex examples:</a>
      <li class='indexItem indexItem3'><a href='#Serialization_Examples'>Serialization Examples</a>
    </ul>
  </ul>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="TITLE"
>TITLE</a></h1>

<p>Synopsis 22: Package Format [DRAFT]</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHORS"
>AUTHORS</a></h1>

<pre><code>Jos Boumans &#60;kane@cpan.org&#62;
Audrey Tang &#60;audreyt@audreyt.org&#62;
Florian Ragwitz &#60;rafl@debian.org&#62;
Tim Nelson &#60;wayland@wayland.id.au&#62;</code></pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="VERSION"
>VERSION</a></h1>

<pre><code>Created: 3 Nov 2005

Last Modified: 19 Dec 2008
Version: 2</code></pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="OVERVIEW"
>OVERVIEW</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Terminology_and_Scope"
>Terminology and Scope</a></h2>

<p>I&#39;ll start by listing a few terms, and whether this document is supposed to cover them or not.</p>

<ul>
<li>.jib files; this is the source package format, and is specified in this document</li>

<li>CPAN6; this is a piece of software for managing an archive network (such as CPAN). This is not specified in this document; see <a href="http://cpan6.org/" class="podlinkurl"
>http://cpan6.org/</a></li>

<li>PAUSE6; this is an actual network based on the cpan6 software (see above). It also is not documented here.</li>

<li>CPAN6.pm; this is a piece of software that starts with what it can get on PAUSE6, and attempts to give you an installed perl module (this is a replacement for CPANPLUS/cpan2dist)</li>
</ul>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Inspirations"
>Inspirations</a></h2>

<p>The following can be useful inspirations:</p>

<ul>
<li>Debian Policy: <a href="http://www.us.debian.org/doc/debian-policy" class="podlinkurl"
>http://www.us.debian.org/doc/debian-policy</a></li>

<li>Software::Packager::Metadata: <a href="http://perlsoftpackmet.svn.sourceforge.net/viewvc/perlsoftpackmet/main/doc/" class="podlinkurl"
>http://perlsoftpackmet.svn.sourceforge.net/viewvc/perlsoftpackmet/main/doc/</a> (click on the link in the Rev. column next to Overview)</li>
</ul>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="PACKAGE_LAYOUT"
>PACKAGE LAYOUT</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Project_directory"
>Project directory</a></h2>

<p>Step 1 of the general flow should ideally be done by an automated tool, like p5&#39;s current Module::Starter or somesuch. Suffice to say, it should produce a layout something along these lines (note, this is just an example):</p>

<pre><code>p5-Foo-Bar/
    lib/
        Foo/
            Bar.pm
    t/
        00_load.t
    _jib/
        META.info</code></pre>

<p>The files in the _jib dir are part of the package metadata. The most important file is the META.info file that holds all the collected metadata about the package, which ideally gets filled (mostly) by what is described in step 2 of the <code>General Flow</code>. Any pre/posthook files should also go in this directory. This directory should be extensible, so new files can be added to extend functionality. See the section on <code> Metadata Spec </code> for details.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name=".jib_files"
>.jib files</a></h2>

<p>These files are created in step 3 of the <code>General Flow</code></p>

<p><code>JIB</code> is a simple 3 letter combination that&#39;s not yet &#39;taken&#39; as a known extension. It&#39;s purposely not perl specific, as there&#39;s nothing about the <code>JIB</code> specification that&#39;s limiting it to perl only.</p>

<p># XXX - Also <code>package</code> is carrying double meaning in P6 as both namespace and source distribution. Can we remove the former meaning and refer to them as <code>module</code> and <code>namespace</code> from now on?</p>

<p><code>.jib</code> files are archives designed to distribute source packages, not installable packages. As we will need to compile things on the client side (things that have C bits or equivalent), and because we can not know the install path before hand, a source package is an obvious choice. A binary, installable package like <code>.deb</code> is therefor no option.</p>

<p>These <code>.jib</code> contain metadata and installable code quite analogous to the <code>.deb</code> packages we know, except that the metadata is also used to <code>compile</code> (for the lack of a better term so far) the code on the user side.</p>

<p>The name of a <code>.jib</code> file is determined as follows:</p>

<pre><code>&#60;prefix&#62;-&#60;package-name&#62;-&#60;version&#62;-&#60;authority&#62;.&#60;extension&#62;</code></pre>

<p>In praxis, this will produce a name along these lines:</p>

<pre><code>p5-Foo-Bar-1.1-cpan+kane.jib</code></pre>

<p>The Internal layout is as follows:</p>

<pre><code>- control.tgz
    * contains the data in the _jib directory
- data.tgz
    * contains the following directories the other directories.
        This may be limited in the future, by say, a manifest.skip
        like functionality, or by dictating a list of directories/
        files that will be included</code></pre>

<p>There is room to ship more files alongside the 2 above mentioned archives. This allows us to ship an extra md5sum, version, signature, anything.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="METADATA_SPEC"
>METADATA SPEC</a></h1>

<pre><code>- Define no more than needed to get started for now
    - Allow for future extensions
    - Use YAML as metadata format as it&#39;s portable and available standard
        in perl6</code></pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Supported_fields"
>Supported fields</a></h2>

<pre><code>- Prefix        Package prefix category     (p5)
- Name          Perl module name            (Foo-Bar)
- Version       Perl module version         (1.2.3)
- Authority     From S11                    (cpan+KANE)
- Package       Full package name           (p5-Foo-Bar-1.2.3-cpan+kane)
- Description   Description of function     (This is what it does)
- Author        CPAN author id              (KANE)
- Depends       Packages it depends on[1][2](p5-Foo)
- Provides      Packages this one provides  (p5-Foo-Bar,
                                                p5-Foo-Bar-cpan+kane)</code></pre>

<p>As the &#60;Prefix&#62;-&#60;Name&#62;-&#60;Version&#62;-&#60;Authority&#62; combination make up the &#60;Package&#62; name, arguably, we can leave the former out. The upside is to make sure all fields contain unique information. The downside is that 3rd party parsers will need to understand the <code>Package</code> syntax.</p>

<p>Again, arguably, the <code>Author</code> and <code>Authority</code> fields overlap, and <code>Authority</code> can be made to hold both cases.</p>

<pre><code>[1] This is packages, *not* modules. If we need a module -&#62; package
    mapping, this needs to be done when extracting the data from the
    compiler, and queried against the available packages cache.
[2] See the section on L&#60;Dependencies&#62;</code></pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Suggested_fields[3]"
>Suggested fields[3]</a></h2>

<pre><code>- Build-Depends Packages needed to build this package
- Suggests      Packages suggested by this package
- Recommends    Packages recommended by this package
- Enhances      Packages that are enhanced by this package
- Conflicts     Packages this one conflicts with
- Replaces      Packages this one replaces
- Tags          Arbitrary metadata about the package,
                like flickr and debtags
- Contains      List of modules (and scripts?) contained
                in the package

[3] Steal more tags from debian policy</code></pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DEPENDENCIES"
>DEPENDENCIES</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Dependency_Notation"
>Dependency Notation</a></h2>

<p>Dependency notation allows you to express the following concepts:</p>

<dl>
<dt><a name="OR"
>OR</a></dt>

<dd>
<p>Specifies alternatives</p>

<dt><a name="AND"
>AND</a></dt>

<dd>
<p>Specifies cumulative requirements</p>

<dt><a name="associate_VERSION_requirement"
>associate VERSION requirement</a></dt>

<dd>
<p>Specifies a criteria for the version requirement</p>

<dt><a name="grouping"
>grouping</a></dt>

<dd>
<p>This allows nesting of the above expressions</p>
</dd>
</dl>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Basic_notation:"
>Basic notation:</a></h3>

<pre><code>a, b                        # a AND b
[a, b]                      # a OR b
{ a =&#62; &#34;&#62; 2&#34; }              # a greater than 2
{ a =&#62; 1 }                  # shorthand for a greater or equal to 1
\[ ... ]                    # grouping</code></pre>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="More_complex_examples:"
>More complex examples:</a></h3>

<pre><code>a, [b,c]                    # a AND (b OR c)
{ a =&#62; 1 }, { a =&#62; &#39;&#60; 2&#39; }  # a greater or equal to 1 AND smaller than 2
[a, \[ b, c ] ]             # a OR (b AND c) [1]

[1] This is possibly not portable to other languages. Options seem
    thin as we don&#39;t have some /other/ grouping mechanism than [ ], { }
    and \[ ]; ( ) gets flattened and \( ) == [ ].
    We could abuse { } to create { OR =&#62; [ ] } and { AND =&#62; [ ] }
    groups, but it would not read very intuitively. It would also mean
    that the version requirements would have to be in the package naming,
    ie. &#39;a &#62; 2&#39; rather than a =&#62; &#39;&#62; 2&#39;</code></pre>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Serialization_Examples"
>Serialization Examples</a></h3>

<pre><code># a, b -- AND
- a
- b

# [a, b] -- OR
-
  - a
  - b

# { a =&#62; &#34;&#62; 2&#34; } -- VERSIONED
a: &#62; 2

# { a =&#62; 1 } -- VERSIONED
a: 1


# \[ ... ]  -- GROUPING
- !perl/ref:
  =:
    - ...</code></pre>

<!-- end doc -->

</body></html>
